# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

IAMS (IT Asset Management System) is a .NET 10 solution for tracking IT assets with QR code scanning and offline mobile support. It consists of three projects:

- **IAMS.Api** - ASP.NET Core Web API with SQLite database
- **IAMS.Web** - Blazor WebAssembly PWA frontend
- **IAMS.Shared** - Shared DTOs between API and Web

## Build Commands

```bash
# Build entire solution
dotnet build

# Run API (https://localhost:5001)
cd src/IAMS.Api && dotnet run

# Run Web (https://localhost:5002)
cd src/IAMS.Web && dotnet run
```

Both projects need to run simultaneously for full functionality.

## Database

SQLite database at `src/IAMS.Api/iams.db`. Migrations auto-apply on startup.

```bash
# Create new migration
cd src/IAMS.Api
dotnet ef migrations add MigrationName

# Apply migrations manually (usually not needed)
dotnet ef database update
```

## Architecture

### Authentication Flow
1. API uses ASP.NET Core Identity with JWT tokens
2. Web stores JWT in localStorage via `AuthService`
3. `AuthStateProvider` manages authentication state
4. `ApiClient` attaches Bearer token to all authenticated requests

### Key Authorization Policies (defined in API Program.cs)
- `Admin` - Admin role only
- `Staff` - Admin or Staff roles
- `CanManageAssets` - Admin or Staff (create/edit/delete assets)
- `CanViewReports` - Admin or Auditor (access reports)

### API Response Pattern
All API endpoints return `ApiResponse<T>` wrapper:
```csharp
public record ApiResponse<T>(bool Success, T? Data, string? Message);
public record PagedResponse<T>(List<T> Items, int TotalCount, int Page, int PageSize);
```

### Offline Support (Web)
- `OfflineStorageService` - IndexedDB wrapper via JS interop
- `NetworkStatusService` - Online/offline detection
- `SyncService` - Queues actions offline, syncs when online
- JavaScript module at `wwwroot/js/offline-storage.js`

### QR Code Scanning
- `QrCodeService` (API) - Generates QR codes with asset URLs
- `wwwroot/js/qrScanner.js` - Html5Qrcode library wrapper
- `Scan.razor` - Scanner UI with offline fallback

## Key Entities

- **Asset** - Core entity with AssetTag (unique), DeviceType, Status, warranty info
- **AssetAssignment** - Tracks assignment history (who, when, return status)
- **WarrantyAlert** - Generated by `WarrantyCheckService` background job
- **ApplicationUser** - Extends IdentityUser with FullName, Department

## Conventions

### Asset Status Values
`Available`, `InUse`, `Maintenance`, `Retired`, `Lost` (see `AssetStatus` class)

### Device Types
`Laptop`, `Desktop`, `Monitor`, `Phone`, `Tablet`, `Printer`, `Network`, `Server`, `Peripheral`, `Software`, `Other` (see `DeviceTypes` class)

### Frontend Styling
Tailwind CSS with custom theme. Dark mode supported via `dark:` prefix classes.

### API Endpoints Pattern
- `/api/assets` - CRUD for assets
- `/api/assignments` - Asset assignment/return operations
- `/api/reports` - Reporting endpoints (inventory, warranty, value)
- `/api/warrantyalerts` - Warranty alert management
- `/api/dashboard` - Dashboard statistics

## Default Credentials (Development)

Seeded via `SeedData.cs`:
- Admin: `admin@iams.local` / `Admin@123`
- Staff: `staff@iams.local` / `Staff@123`
- Auditor: `auditor@iams.local` / `Auditor@123`
