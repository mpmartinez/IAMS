@using IAMS.Shared.DTOs

<a href="/assets/@Asset.Id" class="group block">
    <div class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-4 sm:p-5 card-hover">
        <!-- Header: Icon + Title + Status -->
        <div class="flex items-start gap-3 sm:gap-4">
            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl @GetDeviceTypeBg(Asset.DeviceType) flex items-center justify-center shrink-0 transition-transform duration-200 group-hover:scale-110">
                @if (Asset.DeviceType is "Laptop" or "Desktop")
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                }
                else if (Asset.DeviceType == "Monitor")
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-purple-600 dark:text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                }
                else if (Asset.DeviceType == "Phone")
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                }
                else if (Asset.DeviceType == "Tablet")
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                }
                else if (Asset.DeviceType == "Printer")
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-orange-600 dark:text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                }
                else if (Asset.DeviceType is "Network" or "Server")
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-red-600 dark:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" /></svg>
                }
                else
                {
                    <svg class="w-5 h-5 sm:w-6 sm:h-6 text-slate-600 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>
                }
            </div>
            <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2">
                    <div class="min-w-0">
                        <h3 class="font-semibold text-slate-900 dark:text-white truncate group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors text-sm sm:text-base">
                            @Asset.DisplayName
                        </h3>
                        <p class="text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-0.5 font-mono">@Asset.AssetTag</p>
                    </div>
                    <Badge Text="@Asset.Status" Variant="@Asset.Status" />
                </div>
            </div>
        </div>

        <!-- Info Grid -->
        <div class="mt-4 grid grid-cols-2 gap-x-4 gap-y-2 text-xs sm:text-sm">
            @if (!string.IsNullOrEmpty(Asset.Manufacturer))
            {
                <div class="flex items-center gap-1.5 text-slate-500 dark:text-slate-400">
                    <svg class="w-3.5 h-3.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    <span class="truncate">@Asset.Manufacturer</span>
                </div>
            }
            @if (!string.IsNullOrEmpty(Asset.Model))
            {
                <div class="flex items-center gap-1.5 text-slate-500 dark:text-slate-400">
                    <svg class="w-3.5 h-3.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <span class="truncate">@Asset.Model</span>
                </div>
            }
            @if (!string.IsNullOrEmpty(Asset.SerialNumber))
            {
                <div class="flex items-center gap-1.5 text-slate-500 dark:text-slate-400">
                    <svg class="w-3.5 h-3.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                    </svg>
                    <span class="truncate font-mono text-xs">@Asset.SerialNumber</span>
                </div>
            }
            @if (Asset.PurchasePrice.HasValue)
            {
                <div class="flex items-center gap-1.5 text-slate-500 dark:text-slate-400">
                    <svg class="w-3.5 h-3.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>@FormatPrice(Asset.PurchasePrice.Value, Asset.Currency)</span>
                </div>
            }
        </div>

        <!-- Footer: Assigned User + Warranty Status -->
        <div class="mt-4 pt-3 border-t border-slate-100 dark:border-slate-700 flex items-center justify-between text-xs">
            @if (!string.IsNullOrEmpty(Asset.AssignedToUserName))
            {
                <div class="flex items-center gap-1.5 text-slate-600 dark:text-slate-300">
                    <div class="w-5 h-5 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center">
                        <span class="text-primary-600 dark:text-primary-400 font-medium text-xs">@GetInitials(Asset.AssignedToUserName)</span>
                    </div>
                    <span class="truncate max-w-[100px] sm:max-w-[140px]">@Asset.AssignedToUserName</span>
                </div>
            }
            else
            {
                <span class="text-slate-400 dark:text-slate-500">Unassigned</span>
            }

            @if (Asset.WarrantyStatus != WarrantyStatus.None)
            {
                <div class="flex items-center gap-1.5">
                    <svg class="w-3.5 h-3.5 @GetWarrantyIconClass()" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <Badge Text="@GetWarrantyBadgeText()" Variant="@GetWarrantyBadgeVariant()" Pulse="@(Asset.WarrantyStatus == WarrantyStatus.Expiring)" />
                </div>
            }
        </div>
    </div>
</a>

@code {
    [Parameter] public required AssetDto Asset { get; set; }

    private string GetDeviceTypeBg(string deviceType) => deviceType switch
    {
        "Laptop" or "Desktop" => "bg-blue-100 dark:bg-blue-900/30",
        "Monitor" => "bg-purple-100 dark:bg-purple-900/30",
        "Phone" or "Tablet" => "bg-green-100 dark:bg-green-900/30",
        "Printer" => "bg-orange-100 dark:bg-orange-900/30",
        "Network" or "Server" => "bg-red-100 dark:bg-red-900/30",
        _ => "bg-slate-100 dark:bg-slate-700"
    };

    private string FormatPrice(decimal price, string currency)
    {
        return currency switch
        {
            "USD" => $"${price:N2}",
            "EUR" => $"\u20AC{price:N2}",
            "GBP" => $"\u00A3{price:N2}",
            "PHP" => $"\u20B1{price:N2}",
            "JPY" => $"\u00A5{price:N0}",
            _ => $"{currency} {price:N2}"
        };
    }

    private string GetInitials(string name)
    {
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[^1][0]}".ToUpper();
        return parts.Length > 0 ? parts[0][0].ToString().ToUpper() : "?";
    }

    private string GetWarrantyIconClass() => Asset.WarrantyStatus switch
    {
        WarrantyStatus.Active => "text-emerald-500 dark:text-emerald-400",
        WarrantyStatus.Expiring => "text-amber-500 dark:text-amber-400",
        WarrantyStatus.Expired => "text-red-500 dark:text-red-400",
        _ => "text-slate-400"
    };

    private string GetWarrantyBadgeVariant() => Asset.WarrantyStatus switch
    {
        WarrantyStatus.Active => "warranty-active",
        WarrantyStatus.Expiring => "warranty-expiring",
        WarrantyStatus.Expired => "warranty-expired",
        _ => "default"
    };

    private string GetWarrantyBadgeText()
    {
        var days = Asset.WarrantyDaysRemaining ?? 0;
        return Asset.WarrantyStatus switch
        {
            WarrantyStatus.Active => Asset.WarrantyEndDate?.ToString("MMM yyyy") ?? "Active",
            WarrantyStatus.Expiring => days <= 30 ? $"{days}d left" : $"{days / 30}mo left",
            WarrantyStatus.Expired => "Expired",
            _ => ""
        };
    }
}
